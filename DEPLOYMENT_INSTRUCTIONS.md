# Инструкции по развертыванию на Amvera

## Подготовка к коммиту

### 1. Инициализация Git репозитория

Выполните следующие команды в терминале в директории проекта:

```bash
# Инициализация Git репозитория
git init

# Создание ветки для Amvera
git checkout -b amvera-deployment

# Добавление всех файлов
git add .

# Коммит изменений
git commit -m "feat: адаптация проекта для развертывания на Amvera

- Создан Procfile для определения процессов
- Добавлен runtime.txt с версией Python  
- Создан envExample с примером переменных окружения
- Адаптирована конфигурация для работы с внешними сервисами
- Улучшен main.py с проверкой переменных окружения
- Создан admin_main.py для запуска админ-панели
- Обновлен requirements.txt для совместимости с Amvera
- Добавлена документация по развертыванию на Amvera"
```

### 2. Проверка статуса

```bash
# Проверка статуса
git status

# Просмотр истории коммитов
git log --oneline
```

## Развертывание на Amvera

### 1. Подготовка переменных окружения

1. Скопируйте файл `envExample` в `.env`:
   ```bash
   cp envExample .env
   ```

2. Заполните все переменные в `.env` файле:
   - `TELEGRAM_BOT_TOKEN` - токен вашего Telegram бота
   - `OPENAI_API_KEY` или `GIGACHAT_API_KEY` - ключ AI провайдера
   - `DATABASE_URL` - URL подключения к PostgreSQL
   - `REDIS_URL` - URL подключения к Redis
   - `ADMIN_SECRET_KEY` - секретный ключ для админ-панели
   - `ENCRYPTION_KEY` - ключ шифрования (минимум 32 символа)

### 2. Создание приложения на Amvera

1. Войдите в панель управления Amvera
2. Создайте новое приложение
3. Выберите тип "Python"

### 3. Настройка базы данных

#### PostgreSQL
1. В панели Amvera создайте PostgreSQL базу данных
2. Скопируйте строку подключения в переменную `DATABASE_URL`

#### Redis
1. В панели Amvera создайте Redis инстанс
2. Скопируйте строку подключения в переменную `REDIS_URL`

### 4. Настройка переменных окружения

В панели управления Amvera добавьте все переменные из вашего `.env` файла.

### 5. Загрузка кода

1. Подключите ваш Git репозиторий к Amvera
2. Или загрузите код через интерфейс Amvera

### 6. Запуск

После настройки всех переменных окружения и загрузки кода, Amvera автоматически запустит ваше приложение.

## Структура проекта для Amvera

### Новые файлы:
- `Procfile` - определение процессов для Amvera
- `runtime.txt` - версия Python
- `envExample` - пример переменных окружения
- `admin_main.py` - запуск админ-панели
- `AMVERA_DEPLOYMENT.md` - документация по развертыванию
- `.gitignore` - исключения для Git

### Измененные файлы:
- `utils/config.py` - поддержка DATABASE_URL и REDIS_URL
- `main.py` - улучшенная обработка ошибок
- `requirements.txt` - добавлены зависимости для Amvera

## Процессы в Procfile

- `web` - основной Telegram бот (python main.py)
- `admin` - админ-панель (python admin_main.py)

## Мониторинг

### Логи
- Логи доступны в панели управления Amvera
- Также логи сохраняются в файл `logs/bot.log`

### Админ-панель
- Доступна по адресу: `https://your-app.amvera.io/`
- Логин: `admin`
- Пароль: первые 20 символов от `ADMIN_SECRET_KEY`

## Возможные проблемы

### 1. Ошибки подключения к базе данных
- Проверьте правильность `DATABASE_URL`
- Убедитесь, что база данных доступна

### 2. Ошибки подключения к Redis
- Проверьте правильность `REDIS_URL`
- Приложение будет работать с Memory storage, если Redis недоступен

### 3. Ошибки AI провайдеров
- Проверьте правильность API ключей
- Убедитесь, что провайдер доступен

## Безопасность

### Переменные окружения
- Никогда не коммитьте `.env` файл в Git
- Используйте сильные пароли и ключи

### Админ-панель
- Регулярно меняйте `ADMIN_SECRET_KEY`
- Ограничьте доступ к админ-панели по IP при необходимости

### Шифрование
- Используйте сильный `ENCRYPTION_KEY` (минимум 32 символа)
- Регулярно ротируйте ключи шифрования
