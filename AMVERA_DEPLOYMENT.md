# Развертывание на Amvera

## Подготовка к развертыванию

### 1. Настройка переменных окружения

Скопируйте файл `envExample` в `.env` и заполните все необходимые переменные:

```bash
cp envExample .env
```

### 2. Обязательные переменные для Amvera

Убедитесь, что в `.env` файле установлены следующие переменные:

#### Telegram Bot
- `TELEGRAM_BOT_TOKEN` - токен вашего Telegram бота

#### AI Providers (выберите один)
- `OPENAI_API_KEY` - ключ OpenAI API
- `GIGACHAT_API_KEY` - ключ GigaChat API
- `AI_PROVIDER` - провайдер AI (openai или gigachat)

#### База данных PostgreSQL
- `DATABASE_URL` - полный URL подключения к PostgreSQL
- Или отдельные переменные:
  - `POSTGRES_HOST`
  - `POSTGRES_PORT`
  - `POSTGRES_DB`
  - `POSTGRES_USER`
  - `POSTGRES_PASSWORD`

#### Redis
- `REDIS_URL` - полный URL подключения к Redis
- Или отдельные переменные:
  - `REDIS_HOST`
  - `REDIS_PORT`
  - `REDIS_PASSWORD`
  - `REDIS_DB`

#### Админ-панель
- `ADMIN_SECRET_KEY` - секретный ключ для админ-панели
- `ADMIN_USER_IDS` - ID администраторов через запятую

#### Безопасность
- `ENCRYPTION_KEY` - ключ шифрования (минимум 32 символа)

## Развертывание

### 1. Создание приложения на Amvera

1. Войдите в панель управления Amvera
2. Создайте новое приложение
3. Выберите тип "Python"

### 2. Настройка базы данных

#### PostgreSQL
1. В панели Amvera создайте PostgreSQL базу данных
2. Скопируйте строку подключения в переменную `DATABASE_URL`

#### Redis
1. В панели Amvera создайте Redis инстанс
2. Скопируйте строку подключения в переменную `REDIS_URL`

### 3. Настройка переменных окружения

В панели управления Amvera добавьте все переменные из вашего `.env` файла.

### 4. Загрузка кода

1. Подключите ваш Git репозиторий к Amvera
2. Или загрузите код через интерфейс Amvera

### 5. Настройка процессов

Amvera будет использовать `Procfile` для определения процессов:

- `web` - основной Telegram бот
- `admin` - админ-панель (опционально)

### 6. Запуск

После настройки всех переменных окружения и загрузки кода, Amvera автоматически запустит ваше приложение.

## Мониторинг

### Логи
- Логи доступны в панели управления Amvera
- Также логи сохраняются в файл `logs/bot.log`

### Админ-панель
- Доступна по адресу: `https://your-app.amvera.io/`
- Логин: `admin`
- Пароль: первые 20 символов от `ADMIN_SECRET_KEY`

## Возможные проблемы

### 1. Ошибки подключения к базе данных
- Проверьте правильность `DATABASE_URL`
- Убедитесь, что база данных доступна

### 2. Ошибки подключения к Redis
- Проверьте правильность `REDIS_URL`
- Приложение будет работать с Memory storage, если Redis недоступен

### 3. Ошибки AI провайдеров
- Проверьте правильность API ключей
- Убедитесь, что провайдер доступен

## Масштабирование

### Горизонтальное масштабирование
- Amvera поддерживает автоматическое масштабирование
- Настройте количество экземпляров в панели управления

### Вертикальное масштабирование
- Увеличьте ресурсы (CPU, RAM) в панели управления Amvera

## Резервное копирование

### База данных
- Настройте автоматические бэкапы PostgreSQL в панели Amvera

### Логи
- Логи автоматически ротируются
- Настройте экспорт логов при необходимости

## Безопасность

### Переменные окружения
- Никогда не коммитьте `.env` файл в Git
- Используйте сильные пароли и ключи

### Админ-панель
- Регулярно меняйте `ADMIN_SECRET_KEY`
- Ограничьте доступ к админ-панели по IP при необходимости

### Шифрование
- Используйте сильный `ENCRYPTION_KEY` (минимум 32 символа)
- Регулярно ротируйте ключи шифрования
